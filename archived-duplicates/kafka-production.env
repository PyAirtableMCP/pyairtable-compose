# Kafka Production Configuration for PyAirtable Services
# Copy this file to .env and customize for your environment

# ==============================================================================
# KAFKA EVENT BUS CONFIGURATION
# ==============================================================================

# Event Bus Type (inmemory, kafka)
EVENT_BUS_TYPE=kafka

# Kafka Broker Configuration
KAFKA_BROKERS=kafka-1:29092,kafka-2:29095,kafka-3:29098
KAFKA_TOPIC_PREFIX=pyairtable
KAFKA_CONSUMER_GROUP=pyairtable-services

# ==============================================================================
# KAFKA SECURITY CONFIGURATION
# ==============================================================================

# Security Protocol (PLAINTEXT, SSL, SASL_PLAINTEXT, SASL_SSL)
KAFKA_SECURITY_PROTOCOL=SSL

# SASL Configuration (for SASL_PLAINTEXT and SASL_SSL)
KAFKA_SASL_MECHANISM=SCRAM-SHA-256
KAFKA_SASL_USERNAME=pyairtable-producer
KAFKA_SASL_PASSWORD=pyairtable-producer-secret

# TLS Configuration (for SSL and SASL_SSL)
KAFKA_TLS_INSECURE_SKIP_VERIFY=true
KAFKA_TLS_CERT_FILE=/etc/kafka/secrets/kafka.client.keystore.jks
KAFKA_TLS_KEY_FILE=/etc/kafka/secrets/kafka.client.keystore.jks
KAFKA_TLS_CA_FILE=/etc/kafka/secrets/kafka.client.truststore.jks

# ==============================================================================
# KAFKA PRODUCER CONFIGURATION
# ==============================================================================

# Reliability and Performance
KAFKA_PRODUCER_ACKS=all
KAFKA_PRODUCER_COMPRESSION_TYPE=snappy
KAFKA_PRODUCER_MAX_MESSAGE_BYTES=1048576
KAFKA_PRODUCER_IDEMPOTENT_WRITES=true
KAFKA_PRODUCER_BATCH_SIZE=16384
KAFKA_PRODUCER_LINGER_MS=5
KAFKA_PRODUCER_BUFFER_MEMORY=33554432
KAFKA_PRODUCER_ENABLE_TRANSACTIONS=false

# Retry Configuration
KAFKA_PRODUCER_RETRIES=3
KAFKA_PRODUCER_RETRY_BACKOFF_MS=1000

# ==============================================================================
# KAFKA CONSUMER CONFIGURATION
# ==============================================================================

# Consumer Behavior
KAFKA_CONSUMER_AUTO_OFFSET_RESET=earliest
KAFKA_CONSUMER_SESSION_TIMEOUT_MS=30000
KAFKA_CONSUMER_HEARTBEAT_INTERVAL_MS=3000
KAFKA_CONSUMER_REBALANCE_STRATEGY=roundrobin
KAFKA_CONSUMER_ISOLATION_LEVEL=read_committed
KAFKA_CONSUMER_MAX_PROCESSING_TIME_MS=300000
KAFKA_CONSUMER_FETCH_MIN_BYTES=1
KAFKA_CONSUMER_FETCH_MAX_BYTES=1048576

# ==============================================================================
# OUTBOX PATTERN CONFIGURATION
# ==============================================================================

# Outbox Publisher Settings
OUTBOX_PUBLISHER_TYPE=kafka
OUTBOX_PUBLISHER_BATCH_SIZE=100
OUTBOX_PUBLISHER_BATCH_TIMEOUT_MS=5000
OUTBOX_RETRY_ATTEMPTS=3
OUTBOX_RETRY_DELAY_MS=1000
OUTBOX_DEAD_LETTER_TOPIC=pyairtable.dlq.events

# ==============================================================================
# SAGA ORCHESTRATOR CONFIGURATION
# ==============================================================================

# SAGA Event Configuration
SAGA_EVENT_TOPIC=pyairtable.saga.events
SAGA_COMMAND_TOPIC=pyairtable.commands
SAGA_CONSUMER_GROUP=pyairtable-saga-orchestrator

# ==============================================================================
# SERVICE-SPECIFIC CONFIGURATIONS
# ==============================================================================

# Auth Service Events
AUTH_EVENTS_TOPIC=pyairtable.auth.events
AUTH_CONSUMER_GROUP=pyairtable-auth-service

# Airtable Integration Events
AIRTABLE_EVENTS_TOPIC=pyairtable.airtable.events
AIRTABLE_CONSUMER_GROUP=pyairtable-airtable-service

# File Processing Events
FILES_EVENTS_TOPIC=pyairtable.files.events
FILES_CONSUMER_GROUP=pyairtable-file-service

# Workflow Events
WORKFLOWS_EVENTS_TOPIC=pyairtable.workflows.events
WORKFLOWS_CONSUMER_GROUP=pyairtable-workflow-service

# AI Service Events
AI_EVENTS_TOPIC=pyairtable.ai.events
AI_CONSUMER_GROUP=pyairtable-ai-service

# System Events
SYSTEM_EVENTS_TOPIC=pyairtable.system.events
SYSTEM_CONSUMER_GROUP=pyairtable-system-service

# Analytics Events
ANALYTICS_EVENTS_TOPIC=pyairtable.analytics.events
ANALYTICS_CONSUMER_GROUP=pyairtable-analytics-service

# ==============================================================================
# MONITORING AND OBSERVABILITY
# ==============================================================================

# Kafka Metrics
KAFKA_JMX_ENABLED=true
KAFKA_JMX_PORT=9999

# Event Bus Metrics
EVENT_BUS_METRICS_ENABLED=true
EVENT_BUS_METRICS_INTERVAL_MS=30000

# Distributed Tracing
TRACING_ENABLED=true
JAEGER_ENDPOINT=http://jaeger:14268/api/traces

# ==============================================================================
# DEVELOPMENT OVERRIDES
# ==============================================================================

# Development Environment Overrides
# Uncomment for local development with PLAINTEXT security
# KAFKA_SECURITY_PROTOCOL=PLAINTEXT
# KAFKA_BROKERS=localhost:9092,localhost:9095,localhost:9098

# ==============================================================================
# KUBERNETES OVERRIDES
# ==============================================================================

# Kubernetes Service Discovery
# Uncomment for Kubernetes deployment
# KAFKA_BROKERS=kafka-service:9092
# KAFKA_CONSUMER_GROUP=${HOSTNAME:-pyairtable-services}